<div class="dashboard-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-inner">
      <div class="logo-section">
        <img src="/assets/images/logo-logidoo.svg" alt="Logidoo Logo" class="logo">
      </div>

      <div class="navigation-card">
        <nav class="navigation">
          <a
            class="nav-item"
            routerLink="/dashboard/admin"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }">
            <span class="nav-icon-wrapper">
              <mat-icon class="nav-icon" fontSet="material-icons-outlined">grid_view</mat-icon>
            </span>
            <span class="nav-text">Tableau de bord</span>
          </a>

          <a
            class="nav-item"
            routerLink="/dashboard/admin/users"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }">
            <span class="nav-icon-wrapper">
              <mat-icon class="nav-icon" fontSet="material-icons-outlined">group</mat-icon>
            </span>
            <span class="nav-text">Utilisateurs</span>
          </a>

          <a
            class="nav-item"
            routerLink="/dashboard/admin/conteneurs"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }">
            <span class="nav-icon-wrapper">
              <mat-icon class="nav-icon" fontSet="material-icons-outlined">inventory_2</mat-icon>
            </span>
            <span class="nav-text">Conteneurs</span>
          </a>

          <div class="nav-section-title">
            <span>Administration</span>
          </div>

          <a
            class="nav-item"
            routerLink="/dashboard/admin/profile"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }">
            <span class="nav-icon-wrapper">
              <mat-icon class="nav-icon" fontSet="material-icons-outlined">settings</mat-icon>
            </span>
            <span class="nav-text">Paramètres</span>
          </a>

          <button type="button" class="nav-item logout" (click)="logout()">
            <span class="nav-icon-wrapper">
              <mat-icon class="nav-icon" fontSet="material-icons-outlined">logout</mat-icon>
            </span>
            <span class="nav-text">Se déconnecter</span>
          </button>
        </nav>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="welcome-header">
      <div class="avatar-section">
        <mat-icon class="avatar">admin_panel_settings</mat-icon>
        <span class="welcome-text">Bienvenue, Admin {{ currentUser?.username || 'Administrateur' }}</span>
      </div>
      <div class="user-menu">
        <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-menu-btn">
          <mat-icon class="user-avatar">account_circle</mat-icon>
        </button>
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Se déconnecter</span>
          </button>
        </mat-menu>
      </div>
    </header>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <div class="overview-card">
        <h2>Pilotage de la plateforme</h2>
        <p>Surveillez l’activité globale, suivez l’utilisation des ressources et accédez rapidement aux sections clés.</p>
        <div class="overview-actions">
          <button class="action-btn primary" routerLink="/dashboard/admin/users">
            <mat-icon fontSet="material-icons-outlined">group_add</mat-icon>
            Gérer les utilisateurs
          </button>
          <button class="action-btn secondary" routerLink="/dashboard/admin/conteneurs">
            <mat-icon fontSet="material-icons-outlined">inventory</mat-icon>
            Conteneurs
          </button>
        </div>
      </div>

      <ng-container *ngIf="isLoading">
        <div class="statistics-card key-metrics loading-card">
          <div class="loading-spinner">Chargement des statistiques...</div>
        </div>
        <div class="analytics-grid">
          <div class="stats-card placeholder"></div>
          <div class="stats-card placeholder"></div>
          <div class="stats-card placeholder"></div>
        </div>
      </ng-container>

      <ng-container *ngIf="!isLoading">
        <div class="statistics-card key-metrics">
          <h3>Statistiques clés</h3>
          <div class="stats-list">
            <div class="stat-row">
              <div class="stat-meta">
                <mat-icon fontSet="material-icons-outlined">group</mat-icon>
                <span>Utilisateurs totaux</span>
              </div>
              <span class="stat-value">{{ dashboardStats.totalUsers }}</span>
            </div>
            <div class="stat-row">
              <div class="stat-meta">
                <mat-icon fontSet="material-icons-outlined">assessment</mat-icon>
                <span>Simulations totales</span>
              </div>
              <span class="stat-value">{{ dashboardStats.totalSimulations }}</span>
            </div>
            <div class="stat-row">
              <div class="stat-meta">
                <mat-icon fontSet="material-icons-outlined">trending_up</mat-icon>
                <span>Taux moyen (volume)</span>
              </div>
              <span class="stat-value">{{ dashboardStats.avgFillRate.volume }}%</span>
            </div>
            <div class="stat-row">
              <div class="stat-meta">
                <mat-icon fontSet="material-icons-outlined">balance</mat-icon>
                <span>Taux moyen (poids)</span>
              </div>
              <span class="stat-value">{{ dashboardStats.avgFillRate.weight }}%</span>
            </div>
          </div>
        </div>

        <div class="analytics-grid">
          <div class="stats-card">
            <h3>Simulations par période</h3>
            <div class="period-stats">
              <div class="period-item">
                <div class="period-value">{{ dashboardStats.simulationsByPeriod.day }}</div>
                <div class="period-label">Aujourd'hui</div>
              </div>
              <div class="period-item">
                <div class="period-value">{{ dashboardStats.simulationsByPeriod.week }}</div>
                <div class="period-label">Cette semaine</div>
              </div>
              <div class="period-item">
                <div class="period-value">{{ dashboardStats.simulationsByPeriod.month }}</div>
                <div class="period-label">Ce mois</div>
              </div>
            </div>
          </div>

          <div class="stats-card">
            <h3>Utilisateurs les plus actifs</h3>
            <div class="users-list" *ngIf="dashboardStats.topUsers && dashboardStats.topUsers.length > 0; else emptyUsers">
              <div *ngFor="let user of dashboardStats.topUsers; let i = index" class="user-item">
                <div class="user-rank">{{ i + 1 }}</div>
                <div class="user-name">{{ user.name }}</div>
                <div class="user-count">{{ user.simulations }}</div>
              </div>
            </div>
            <ng-template #emptyUsers>
              <div class="empty-state">Aucun utilisateur actif pour le moment</div>
            </ng-template>
          </div>

          <div class="stats-card">
            <h3>Utilisation des conteneurs</h3>
            <div class="container-stats" *ngIf="dashboardStats.mostUsedContainers && dashboardStats.mostUsedContainers.length > 0; else emptyContainers">
              <div *ngFor="let container of dashboardStats.mostUsedContainers" class="container-item">
                <div class="container-label">{{ container.type }}</div>
                <div class="container-value">{{ container.percentage }}%</div>
              </div>
            </div>
            <ng-template #emptyContainers>
              <div class="empty-state">Aucune donnée sur l'utilisation des conteneurs</div>
            </ng-template>
          </div>
        </div>
      </ng-container>
    </div>
  </main>
</div>
