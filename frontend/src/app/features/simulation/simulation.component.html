<div class="logidoo-container">
  <!-- Header -->
  <div class="header">
    <button class="back-btn" routerLink="/dashboard/user">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
    </button>
    <div class="logo-container">
      <div class="logo">
        <span class="logo-text">Logid</span>
        <span class="logo-infinity">‚àû</span>
      </div>
    </div>
  </div>

  <!-- Title -->
  <div class="title-section">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
      <polyline points="9,22 9,12 15,12 15,22" />
    </svg>
    <h1>Aide au Chargement</h1>
  </div>

  <!-- Stepper Navigation -->
  <div class="stepper-container">
    <div class="stepper-steps" [ngClass]="'step-' + currentStep">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1" (click)="goToStep(1)">
        <div class="step-circle">1</div>
        <span class="step-label">Informations Simulation</span>
      </div>
      
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2" 
           (click)="currentStep > 1 || canProceedFromStep1() ? goToStep(2) : null"
           [class.disabled]="currentStep === 1 && !canProceedFromStep1()">
        <div class="step-circle">2</div>
        <span class="step-label">Ajout de Colis</span>
      </div>
      
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3"
           (click)="currentStep > 2 || (canProceedFromStep1() && canProceedFromStep2()) ? goToStep(3) : null"
           [class.disabled]="currentStep < 3 && (!canProceedFromStep1() || !canProceedFromStep2())">
        <div class="step-circle">3</div>
        <span class="step-label">Choix de Contenant</span>
      </div>

      <div class="step" [class.active]="currentStep === 4" [class.completed]="currentStep > 4"
           (click)="currentStep > 3 || canProceedFromStep3() ? goToStep(4) : null"
           [class.disabled]="currentStep < 4 && !canProceedFromStep3()">
        <div class="step-circle">4</div>
        <span class="step-label">Calcul & Simulation</span>
      </div>

      <div class="step" [class.active]="currentStep === 5" [class.completed]="currentStep > 5"
           (click)="currentStep > 4 || simulationResultats ? goToStep(5) : null"
           [class.disabled]="!simulationResultats">
        <div class="step-circle">5</div>
        <span class="step-label">Visualisation</span>
      </div>

      <div class="step" [class.active]="currentStep === 6"
           (click)="currentStep > 4 || simulationResultats ? goToStep(6) : null"
           [class.disabled]="!simulationResultats">
        <div class="step-circle">6</div>
        <span class="step-label">Export</span>
      </div>
    </div>
  </div>

  <!-- Step 1: Informations Simulation -->
  <div class="step-content" *ngIf="currentStep === 1">
    <div class="simulation-info">
      <form [formGroup]="simulationForm" class="simulation-form">
        <div class="form-row">
          <div class="form-group">
            <label>Nom de la simulation *</label>
            <input type="text" formControlName="nom" placeholder="Ex: Livraison Paris - Janvier 2025"
              class="form-control">
          </div>
          <div class="form-group">
            <label>Description (optionnel)</label>
            <input type="text" formControlName="description" placeholder="Description de la simulation"
              class="form-control">
          </div>
        </div>
      </form>
      
      <div class="step-actions">
        <button class="btn-primary" (click)="nextStep()" [disabled]="!canProceedFromStep1()">
          Suivant : Ajouter des colis
        </button>
      </div>
    </div>
  </div>

  <!-- Step 2: Ajout de Colis -->
  <div class="step-content" *ngIf="currentStep === 2">
    <div class="compact-layout">
      <!-- Formulaire d'ajout de colis optimis√© -->
      <div class="colis-form-card">
        <div class="form-header">
          <h2>
            <span class="icon">üì¶</span>
            Ajouter un colis
          </h2>
        </div>

        <form [formGroup]="colisForm" class="compact-form">
          <!-- Ligne 1: Type et Quantit√© -->
          <div class="form-row-compact">
            <div class="form-group flex-2">
              <label>Type de colis *</label>
              <input type="text" formControlName="type" placeholder="Ex: Carton, Palette..." class="form-control">
            </div>
            <div class="form-group flex-1">
              <label>Quantit√© *</label>
              <input type="number" formControlName="quantite" class="form-control" min="1">
            </div>
          </div>

          <!-- Ligne 2: Dimensions -->
          <div class="dimensions-group">
            <label class="group-label">Dimensions (cm) *</label>
            <div class="form-row-compact">
              <div class="form-group">
                <input type="number" formControlName="longueur" placeholder="L" class="form-control">
                <small>Longueur</small>
              </div>
              <div class="form-group">
                <input type="number" formControlName="largeur" placeholder="l" class="form-control">
                <small>Largeur</small>
              </div>
              <div class="form-group">
                <input type="number" formControlName="hauteur" placeholder="H" class="form-control">
                <small>Hauteur</small>
              </div>
              <div class="form-group">
                <input type="number" step="0.1" formControlName="poids" placeholder="Poids" class="form-control">
                <small>Poids (kg)</small>
              </div>
            </div>
          </div>

          <!-- Ligne 3: Options -->
          <div class="options-group">
            <div class="checkbox-row">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="fragile" />
                <span class="checkmark"></span>
                Fragile
              </label>
              <label class="checkbox-label">
                <input type="checkbox" formControlName="gerbable" />
                <span class="checkmark"></span>
                Empilable
              </label>
              <div class="color-picker">
                <label>Couleur</label>
                <input type="color" formControlName="couleur" class="color-input">
              </div>
            </div>
          </div>

          <!-- Section destinataire repliable -->
          <div class="collapsible-section">
            <button type="button" class="toggle-btn" (click)="showDestinataireForm = !showDestinataireForm">
              <span [class.rotated]="showDestinataireForm">‚ñ∂</span>
              Informations destinataire (optionnel)
            </button>
            
            <div class="collapsible-content" [class.expanded]="showDestinataireForm">
              <div class="form-row-compact">
                <div class="form-group">
                  <input type="text" formControlName="nomDestinataire" placeholder="Nom" class="form-control">
                </div>
                <div class="form-group flex-2">
                  <input type="text" formControlName="adresse" placeholder="Adresse" class="form-control">
                </div>
                <div class="form-group">
                  <input type="tel" formControlName="telephone" placeholder="T√©l√©phone" class="form-control">
                </div>
              </div>
            </div>
          </div>

          <button type="button" (click)="ajouterColis()" class="btn-add-colis" [disabled]="!colisForm.valid">
            <span class="btn-icon">+</span>
            Ajouter le colis
          </button>
        </form>
      </div>

      <!-- Import Excel compact -->
      <div class="import-card">
        <div class="import-header">
          <span class="icon">ÔøΩ</span>
          <span>Import Excel</span>
        </div>
        <input type="file" #fileInput accept=".xlsx,.xls" (change)="importerDepuisExcel($event)" class="file-input" id="excel-file">
        <label for="excel-file" class="btn-import">
          Choisir un fichier
        </label>
        <button class="btn-template" (click)="telechargerModele()">
          T√©l√©charger mod√®le
        </button>
      </div>
    </div>

    <!-- Liste des colis ajout√©s -->
    <div class="colis-list" *ngIf="listeColis.length > 0">
      <div class="colis-header-section">
        <h3>Colis ajout√©s ({{ calculerNombreColisTotal() }})</h3>
        <div class="pagination-controls-top" *ngIf="listeColis.length > 5">
          <select [(ngModel)]="colisPerPage" (change)="onPageSizeChange()" class="page-size-selector">
            <option value="5">5 par page</option>
            <option value="10">10 par page</option>
            <option value="20">20 par page</option>
            <option value="50">Tout afficher</option>
          </select>
        </div>
      </div>
      
      <div class="colis-grid">
        <div *ngFor="let colis of getPaginatedColis(); let i = index" class="colis-item">
          <div class="colis-header">
            <div class="colis-color" [style.background-color]="colis.couleur"></div>
            <span class="colis-type">{{ colis.type }}</span>
            <span class="colis-quantity">x{{ colis.quantite }}</span>
            <button class="delete-btn" (click)="supprimerColis(getCurrentPageIndex() * colisPerPage + i)">√ó</button>
          </div>
          
          <div class="colis-details">
            <div class="dimension-grid">
              <div class="dimension-item">
                <span class="label">L:</span>
                <span class="value">{{ colis.longueur }}cm</span>
              </div>
              <div class="dimension-item">
                <span class="label">l:</span>
                <span class="value">{{ colis.largeur }}cm</span>
              </div>
              <div class="dimension-item">
                <span class="label">H:</span>
                <span class="value">{{ colis.hauteur }}cm</span>
              </div>
              <div class="dimension-item">
                <span class="label">Poids:</span>
                <span class="value">{{ colis.poids }}kg</span>
              </div>
            </div>
            
            <div class="colis-properties">
              <span *ngIf="colis.fragile" class="property-badge fragile">Fragile</span>
              <span *ngIf="colis.gerbable" class="property-badge gerbable">Empilable</span>
              <span *ngIf="!colis.gerbable" class="property-badge non-gerbable">Non empilable</span>
            </div>
            
            <div class="colis-actions">
              <label class="color-input">
                Couleur:
                <input type="color" [value]="colis.couleur" 
                       (change)="updateColisCouleur(getCurrentPageIndex() * colisPerPage + i, $any($event.target).value)">
              </label>
              <label class="checkbox-input">
                <input type="checkbox" [checked]="colis.fragile" (change)="toggleFragile(getCurrentPageIndex() * colisPerPage + i)"> Fragile
              </label>
              <label class="checkbox-input">
                <input type="checkbox" [checked]="colis.gerbable" (change)="toggleGerbable(getCurrentPageIndex() * colisPerPage + i)"> Empilable
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Contr√¥les de pagination en bas -->
      <div class="pagination-controls-bottom" *ngIf="getTotalPages() > 1">
        <div class="pagination-info">
          Affichage {{ getStartIndex() + 1 }} - {{ getEndIndex() }} sur {{ listeColis.length }} colis
        </div>
        <div class="pagination-buttons">
          <button class="btn-pagination" [disabled]="currentPage === 0" (click)="goToFirstPage()" title="Premi√®re page">
            ‚èÆÔ∏è
          </button>
          <button class="btn-pagination" [disabled]="currentPage === 0" (click)="prevPage()" title="Page pr√©c√©dente">
            ‚óÄÔ∏è
          </button>
          
          <div class="pagination-numbers">
            <button 
              *ngFor="let page of getVisiblePageNumbers(); let i = index" 
              class="btn-page-number"
              [class.active]="page - 1 === currentPage"
              (click)="goToPage(page - 1)">
              {{ page }}
            </button>
          </div>
          
          <button class="btn-pagination" [disabled]="currentPage >= getTotalPages() - 1" (click)="nextPage()" title="Page suivante">
            ‚ñ∂Ô∏è
          </button>
          <button class="btn-pagination" [disabled]="currentPage >= getTotalPages() - 1" (click)="goToLastPage()" title="Derni√®re page">
            ‚è≠Ô∏è
          </button>
        </div>
      </div>
    </div>

    <div class="step-actions">
      <button class="btn-secondary" (click)="prevStep()">Pr√©c√©dent</button>
      <button class="btn-primary" (click)="nextStep()" [disabled]="!canProceedFromStep2()">
        Suivant : Choisir un contenant
      </button>
    </div>
  </div>

  <!-- Step 3: Choix de Contenant -->
  <div class="step-content" *ngIf="currentStep === 3">
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üß±</div>
        <h2>S√©lection du contenant</h2>
        <div class="selection-mode-toggle">
          <label [class.active]="selectionAutoOptimal">
            <input type="checkbox" [checked]="selectionAutoOptimal" (change)="toggleSelectionMode()">
            S√©lection automatique
          </label>
        </div>
      </div>

      <!-- Message explicatif pour le mode de s√©lection -->
      <div class="selection-mode-explanation">
        <p *ngIf="selectionAutoOptimal">
          Mode <strong>automatique</strong> activ√© : le conteneur le plus optimal sera s√©lectionn√© pour vos colis
        </p>
        <p *ngIf="!selectionAutoOptimal">
          Mode <strong>manuel</strong> activ√© : s√©lectionnez le conteneur de votre choix
        </p>
      </div>

      <!-- Affichage du conteneur optimal -->
      <div *ngIf="selectionAutoOptimal && optimalContainer" class="optimal-container-info">
        <div class="optimal-container-card">
          <div class="optimal-badge">
            <span>Recommand√©</span>
          </div>

          <div class="container-header">
            <strong>{{ optimalContainer.containerType }}</strong>
            <span class="container-category">{{ optimalContainer.containerCategory }}</span>
          </div>

          <div class="container-stats">
            <div class="stat">
              <div class="progress-bar">
                <div class="progress" [style.width]="(optimalContainer.volumeUtilization * 100) + '%'"></div>
              </div>
              <div class="stat-label">
                <span>Volume: {{ optimalContainer.volumeUtilization | percent:'1.0-0' }}</span>
              </div>
            </div>

            <div class="stat">
              <div class="progress-bar">
                <div class="progress" [style.width]="(optimalContainer.weightUtilization * 100) + '%'"></div>
              </div>
              <div class="stat-label">
                <span>Poids: {{ optimalContainer.weightUtilization | percent:'1.0-0' }}</span>
              </div>
            </div>

            <div class="placement-info">
              <strong>{{ optimalContainer.placedItems }}</strong> / {{ optimalContainer.totalItems }} colis plac√©s
            </div>
          </div>

          <div class="container-dimensions">
            <span>{{ optimalContainer.dimensions.longueur }} √ó {{ optimalContainer.dimensions.largeur }} √ó {{
              optimalContainer.dimensions.hauteur }} mm</span>
            <span>Volume: {{ optimalContainer.volume }} m¬≥</span>
            <span>Capacit√©: {{ optimalContainer.capacitePoids }} kg max</span>
          </div>
        </div>
      </div>

      <!-- Affichage des stats du conteneur s√©lectionn√© manuellement -->
      <div *ngIf="!selectionAutoOptimal && selectedContainerStats" class="selected-container-info">
        <div class="selected-container-card">
          <div class="container-header">
            <strong>{{ selectedContainerStats.containerType }}</strong>
            <span class="container-category">{{ selectedContainerStats.containerCategory }}</span>
          </div>

          <div class="container-stats">
            <div class="stat">
              <div class="progress-bar">
                <div class="progress" [style.width]="(selectedContainerStats.volumeUtilization * 100) + '%'"></div>
              </div>
              <div class="stat-label">
                <span>Volume: {{ selectedContainerStats.volumeUtilization | percent:'1.0-0' }}</span>
              </div>
            </div>

            <div class="stat">
              <div class="progress-bar">
                <div class="progress" [style.width]="(selectedContainerStats.weightUtilization * 100) + '%'"></div>
              </div>
              <div class="stat-label">
                <span>Poids: {{ selectedContainerStats.weightUtilization | percent:'1.0-0' }}</span>
              </div>
            </div>
          </div>

          <div class="placement-stats">
            <span class="placement-info">
              <strong>{{ selectedContainerStats.placedItems }}</strong> / {{ selectedContainerStats.totalItems }}
              colis plac√©s
            </span>
            <span class="score-info" [class.good-score]="selectedContainerStats.optimalityScore > 0.7"
              [class.medium-score]="selectedContainerStats.optimalityScore > 0.4 && selectedContainerStats.optimalityScore <= 0.7"
              [class.low-score]="selectedContainerStats.optimalityScore <= 0.4">
              Score d'optimalit√©: {{ selectedContainerStats.optimalityScore | percent:'1.0-0' }}
            </span>
          </div>

          <div class="container-dimensions">
            <span>{{ selectedContainerStats.dimensions.longueur }} √ó {{ selectedContainerStats.dimensions.largeur }} √ó
              {{ selectedContainerStats.dimensions.hauteur }} mm</span>
            <span>Volume: {{ selectedContainerStats.volume }} m¬≥</span>
            <span>Capacit√©: {{ selectedContainerStats.capacitePoids }} kg max</span>
          </div>
        </div>
      </div>

      <!-- Indicateur de chargement pour l'√©valuation du conteneur -->
      <div *ngIf="evaluatingContainer" class="container-loading">
        <div class="loading-spinner"></div>
        <span>√âvaluation du conteneur en cours...</span>
      </div>

      <!-- Liste des conteneurs disponibles -->
      <div class="contenants-grid" [class.dimmed]="selectionAutoOptimal && optimalContainer">
        <div *ngFor="let c of containers" class="conteneur-card" [class.selected]="c._id === selectedContainerId"
          [class.optimal]="optimalContainer && c._id === optimalContainer.containerId"
          (click)="selectContainer(c._id)">
          <img *ngIf="c.images && c.images.length > 0" [src]="'https://logidoo.onrender.com' + c.images[0]"
            [alt]="c.type" width="100">
          <div class="conteneur-title">Type: {{ c.type }}</div>
          <div class="conteneur-dimensions">
            {{ c.dimensions.longueur }} √ó {{ c.dimensions.largeur }} √ó {{ c.dimensions.hauteur }} mm
          </div>
          <div class="conteneur-volume">Volume: {{ c.volume }} m¬≥</div>
          <div class="conteneur-poids">Capacit√©: {{ c.capacitePoids }} kg max</div>
          <span class="conteneur-badge" *ngIf="c.categorie === 'conteneur'">Conteneurs</span>
          <span class="conteneur-badge camion" *ngIf="c.categorie === 'camion'">Camions</span>
          <div *ngIf="optimalContainer && c._id === optimalContainer.containerId" class="optimal-marker">
            <span>Optimal</span>
          </div>
        </div>
      </div>
    </div>

    <!-- R√©sum√© des colis -->
    <div *ngIf="listeColis.length > 0" class="card colis-summary-card">
      <h3>R√©sum√© des colis ({{ calculerNombreColisTotal() }})</h3>
      <div class="colis-summary">
        <div class="summary-item">
          <strong>{{ calculerNombreColisTotal() }}</strong>
          <span>Total colis</span>
        </div>
        <div class="summary-item">
          <strong>{{ calculerVolumeTotal() | number:'1.2-2' }} m¬≥</strong>
          <span>Volume total</span>
        </div>
        <div class="summary-item">
          <strong>{{ calculerPoidsTotal() | number:'1.2-2' }} kg</strong>
          <span>Poids total</span>
        </div>
      </div>
    </div>

    <div class="step-actions">
      <button class="btn-secondary" (click)="prevStep()">Pr√©c√©dent</button>
      <button (click)="goToStep(4)" class="btn-primary"
        *ngIf="listeColis.length > 0 && (selectedContainerId || selectionAutoOptimal)"
        [disabled]="findingOptimal">
        Continuer vers le calcul
      </button>
    </div>
  </div>

  <!-- √âtape 4: Calcul & Simulation -->
  <div [hidden]="currentStep !== 4" class="step-content">
    <div class="card">
      <h3>Calcul et Simulation</h3>
      <div *ngIf="!simulationResultats && !simulationEnCours" class="simulation-launch">
        <p>Pr√™t √† calculer la r√©partition optimale de vos {{ calculerNombreColisTotal() }} colis :</p>
        <div class="simulation-preview">
          <div class="preview-item">
            <strong>Volume total :</strong> {{ calculerVolumeTotal() | number:'1.2-2' }} m¬≥
          </div>
          <div class="preview-item">
            <strong>Poids total :</strong> {{ calculerPoidsTotal() | number:'1.2-2' }} kg
          </div>
          <div class="preview-item" *ngIf="selectedContainerId">
            <strong>Conteneur s√©lectionn√© :</strong> {{ getSelectedContainerInfo() }}
          </div>
        </div>
        <button (click)="lancerSimulation()" class="btn-primary btn-large" [disabled]="findingOptimal">
          <span *ngIf="!findingOptimal">üöÄ Lancer le calcul</span>
          <span *ngIf="findingOptimal">‚è≥ Calcul en cours...</span>
        </button>
      </div>

      <div *ngIf="simulationEnCours" class="simulation-progress">
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <p>Calcul de la r√©partition optimale en cours...</p>
        </div>
      </div>

      <div *ngIf="simulationResultats" class="simulation-results">
        <h4>‚úÖ R√©sultats du calcul</h4>
        <div class="results-grid">
          <div class="result-card">
            <h5>Efficacit√©</h5>
            <div class="result-value">{{ (simulationResultats.stats.avgVolumeUtilization * 100) | number:'1.1-1' }}%</div>
          </div>
          <div class="result-card">
            <h5>Volume total</h5>
            <div class="result-value">{{ simulationResultats.stats.totalVolume | number:'1.2-2' }} m¬≥</div>
          </div>
          <div class="result-card">
            <h5>Colis plac√©s</h5>
            <div class="result-value">{{ simulationResultats.stats.placedCount }}/{{ calculerNombreColisTotal() }}</div>
          </div>
          <div class="result-card">
            <h5>Conteneurs utilis√©s</h5>
            <div class="result-value">{{ simulationResultats.stats.containersCount }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="step-actions">
      <button class="btn-secondary" (click)="prevStep()">Pr√©c√©dent</button>
      <button (click)="goToStep(5)" class="btn-primary" 
        *ngIf="simulationResultats" [disabled]="!simulationResultats">
        Voir la visualisation
      </button>
    </div>
  </div>

  <!-- √âtape 5: Visualisation -->
  <div [hidden]="currentStep !== 5" class="step-content">
    <div class="card">
      <h3>Visualisation 3D</h3>
      <div *ngIf="simulationResultats" class="visualization-container">
        <div class="visualization-header">
          <h4>R√©sultats de la simulation</h4>
          <p>Votre simulation a √©t√© calcul√©e avec succ√®s. Vous pouvez maintenant visualiser le placement des colis.</p>
        </div>

        <div class="simulation-summary-before-viz">
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-icon">üìä</div>
              <div class="summary-content">
                <h5>Efficacit√©</h5>
                <span class="summary-value">{{ (simulationResultats.stats.avgVolumeUtilization * 100) | number:'1.1-1' }}%</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">üì¶</div>
              <div class="summary-content">
                <h5>Colis plac√©s</h5>
                <span class="summary-value">{{ simulationResultats.stats.placedCount }}/{{ calculerNombreColisTotal() }}</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">üöõ</div>
              <div class="summary-content">
                <h5>Conteneurs</h5>
                <span class="summary-value">{{ simulationResultats.stats.containersCount }}</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">üìê</div>
              <div class="summary-content">
                <h5>Volume total</h5>
                <span class="summary-value">{{ simulationResultats.stats.totalVolume | number:'1.2-2' }} m¬≥</span>
              </div>
            </div>
          </div>
        </div>

        <div class="visualization-actions">
          <button class="btn-primary btn-large" (click)="ouvrirVisualisationComplete()">
            üéØ Ouvrir la visualisation 3D compl√®te
          </button>
          <p class="visualization-description">
            La visualisation compl√®te vous donnera acc√®s √† tous les outils d'analyse 3D/2D,
            d'export et de manipulation des vues.
          </p>
        </div>
      </div>
    </div>

    <div class="step-actions">
      <button class="btn-secondary" (click)="prevStep()">Pr√©c√©dent</button>
      <button (click)="goToStep(6)" class="btn-primary">
        Acc√©der aux options d'export
      </button>
    </div>
  </div>

  <!-- √âtape 6: Export et Actions -->
  <div [hidden]="currentStep !== 6" class="step-content">
    <div class="card">
      <h3>Export et Actions</h3>
      <div class="export-options">
        <div class="export-section">
          <h4>üìä Actions sur votre simulation</h4>
          <div class="actions-grid">
            <div class="action-card">
              <div class="action-icon">üéØ</div>
              <h5>Visualisation compl√®te</h5>
              <p>Acc√®s √† la visualisation 3D avanc√©e avec tous les outils d'analyse</p>
              <button class="btn-primary" (click)="ouvrirVisualisationComplete()">
                Ouvrir la visualisation
              </button>
            </div>
            
            <div class="action-card">
              <div class="action-icon">ÔøΩ</div>
              <h5>Export Excel</h5>
              <p>T√©l√©charger les donn√©es de la simulation au format Excel</p>
              <button class="btn-primary" (click)="exportExcel()">
                T√©l√©charger Excel
              </button>
            </div>
            
            <div class="action-card">
              <div class="action-icon">ÔøΩ</div>
              <h5>Sauvegarder</h5>
              <p>Enregistrer votre simulation pour la retrouver plus tard</p>
              <button class="btn-primary" (click)="sauvegarderSimulation()">
                Sauvegarder simulation
              </button>
            </div>
            
            <div class="action-card">
              <div class="action-icon">ÔøΩ</div>
              <h5>Nouvelle simulation</h5>
              <p>Recommencer avec de nouveaux colis et param√®tres</p>
              <button class="btn-secondary" (click)="nouvelleSimulation()">
                Nouveau calcul
              </button>
            </div>
          </div>
        </div>

        <div class="export-section" *ngIf="simulationResultats">
          <h4>ÔøΩ R√©sum√© de votre simulation</h4>
          <div class="final-summary">
            <div class="summary-row">
              <span class="summary-label">Nom de la simulation :</span>
              <span class="summary-value">{{ getSimulationName() }}</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Date :</span>
              <span class="summary-value">{{ dateAujourdhui | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Colis trait√©s :</span>
              <span class="summary-value">{{ calculerNombreColisTotal() }} articles</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Conteneurs utilis√©s :</span>
              <span class="summary-value">{{ simulationResultats.stats.containersCount }}</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Efficacit√© moyenne :</span>
              <span class="summary-value highlight">{{ (simulationResultats.stats.avgVolumeUtilization * 100) | number:'1.1-1' }}%</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Volume total utilis√© :</span>
              <span class="summary-value">{{ simulationResultats.stats.totalVolume | number:'1.2-2' }} m¬≥</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="step-actions">
      <button class="btn-secondary" (click)="prevStep()">Pr√©c√©dent</button>
      <button class="btn-primary" (click)="nouvelleSimulation()">
        Nouvelle simulation
      </button>
    </div>
  </div>

</div>