<div class="logidoo-container">
  <!-- Header -->
  <div class="header">
    <button class="back-btn" routerLink="/dashboard/user">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
    </button>
    <div class="logo-container">
      <div class="logo">
        <span class="logo-text">Logid</span>
        <span class="logo-infinity">âˆž</span>
      </div>
    </div>
  </div>

  <!-- Title -->
  <div class="title-section">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
      <polyline points="9,22 9,12 15,12 15,22" />
    </svg>
    <h1>Nouvelle Simulation</h1>
  </div>

  <!-- Informations Simulation -->
  <div class="simulation-info">
    <!-- Ajoutez cette ligne dans votre module Angular (simulation.module.ts ou app.module.ts) :
    import { ReactiveFormsModule } from '@angular/forms';
    @NgModule({
        imports: [
            ReactiveFormsModule,
            // ... autres imports
        ],
    })
    export class SimulationModule { }
    -->

    <form [formGroup]="simulationForm" class="simulation-form">
      <div class="form-row">
        <div class="form-group">
          <label>Nom de la simulation *</label>
          <input type="text" formControlName="nom" placeholder="Ex: Livraison Paris - Janvier 2025"
            class="form-control">
        </div>
        <div class="form-group">
          <label>Description (optionnel)</label>
          <input type="text" formControlName="description" placeholder="Description de la simulation"
            class="form-control">
        </div>
      </div>
    </form>
  </div>

  <div class="main-content">
    <!-- Formulaire d'ajout de colis -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon add-icon">+</div>
        <h2>Ajouter un colis</h2>
      </div>

      <form [formGroup]="colisForm" class="colis-form">
        <div class="form-group">
          <label>Type de colis *</label>
          <input type="text" formControlName="type" placeholder="Ex: Carton, Palette, Sac ..." class="form-control">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Longueur (cm) *</label>
            <input type="number" formControlName="longueur" class="form-control">
          </div>
          <div class="form-group">
            <label>Largeur (cm) *</label>
            <input type="number" formControlName="largeur" class="form-control">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Hauteur (cm) *</label>
            <input type="number" formControlName="hauteur" class="form-control">
          </div>
          <div class="form-group">
            <label>Poids (kg) *</label>
            <input type="number" step="0.1" formControlName="poids" class="form-control">
          </div>
        </div>

        <div class="form-group">
          <label>QuantitÃ© *</label>
          <input type="number" formControlName="quantite" class="form-control">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label><input type="checkbox" formControlName="fragile" /> Fragile</label>
          </div>
          <div class="form-group">
            <label><input type="checkbox" formControlName="gerbable" /> Empilable (gerbable)</label>
          </div>
          <div class="form-group">
            <label>Couleur</label>
            <input type="color" formControlName="couleur" class="form-control" style="height:40px;padding:0;">
          </div>
        </div>

        <!-- Champs destinataire (optionnels) -->
        <div class="destinataire-section">
          <h4>Informations destinataire (optionnel)</h4>
          <div class="form-group">
            <label>Nom Destinataire</label>
            <input type="text" formControlName="nomDestinataire" class="form-control">
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <input type="text" formControlName="adresse" class="form-control">
          </div>
          <div class="form-group">
            <label>TÃ©lÃ©phone</label>
            <input type="tel" formControlName="telephone" class="form-control">
          </div>
        </div>

        <button type="button" (click)="ajouterColis()" class="btn-primary full-width" [disabled]="!colisForm.valid">
          Ajouter le colis
        </button>
      </form>
    </div>

    <!-- Colonne droite: wrapper qui empile le choix conteneur + Import Excel -->
    <div class="right-column">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ðŸ§±</div>
          <h2>Choisir un conteneur</h2>
        </div>
        <div class="contenants-grid">
          <div *ngFor="let c of containers" class="conteneur-card" [class.selected]="c._id === selectedContainerId"
            (click)="selectContainer(c._id)">
            <img *ngIf="c.images && c.images.length > 0"
                 [src]="'https://logidoo.onrender.com' + c.images[0]"
                 [alt]="c.type" width="100">
            <div class="conteneur-title">Type: {{ c.type }}</div>
            <div class="conteneur-dimensions">
              {{ c.dimensions.longueur }} Ã— {{ c.dimensions.largeur }} Ã— {{ c.dimensions.hauteur }} mm
            </div>
            <div class="conteneur-volume">Volume: {{ c.volume }} mÂ³</div>
            <div class="conteneur-poids">CapacitÃ©: {{ c.capacitePoids }} kg max</div>
            <span class="conteneur-badge" *ngIf="c.categorie === 'conteneur'">Conteneurs</span>
            <span class="conteneur-badge camion" *ngIf="c.categorie === 'camion'">Camions</span>
          </div>
        </div>
      </div>

      <!-- Section Import Excel (rÃ©duite) -->
      <div class="card compact">
        <div class="card-header">
          <div class="card-icon excel-icon">ðŸ“Š</div>
          <h2>Import Excel</h2>
        </div>
        <div class="excel-actions">
          <button (click)="telechargerModele()" class="btn-download">ðŸ“¥ TÃ©lÃ©charger le modÃ¨le</button>
          <label class="btn-import" style="margin-top: 0.75rem;">
            ðŸ“¤ Importer Excel
            <input type="file" (change)="importerDepuisExcel($event)" accept=".xlsx,.xls,.csv" style="display: none;">
          </label>
          <p class="excel-hint">Colonnes supportÃ©es: Type, Dimensions, Poids, QtÃ©, Destinataire, Fragile, Gerbable, Couleur.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Liste des colis -->
  <div *ngIf="listeColis.length > 0" class="card colis-list">
    <h3>Colis de la simulation ({{ listeColis.length }})</h3>
    <div class="colis-items">
      <div *ngFor="let colis of listeColis; let i = index" class="colis-item">
        <div class="colis-info">
          <span class="colis-type">
            <span style="display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:6px;vertical-align:middle;"
                  [style.background]="colis.couleur || '#999999'"></span>
            {{ colis.type }}
          </span>
          <span class="colis-dimensions">
            {{ colis.longueur }}Ã—{{ colis.largeur }}Ã—{{ colis.hauteur }}cm - {{ colis.poids }}kg
          </span>
          <span *ngIf="colis.quantite > 1" class="colis-quantity">
            QtÃ©: {{ colis.quantite }}
          </span>
          <span *ngIf="colis.fragile" class="colis-flag" style="margin-left:8px;">Fragile</span>
          <span *ngIf="colis.gerbable" class="colis-flag" style="margin-left:8px;">Empilable</span>
          <div *ngIf="colis.nomDestinataire" class="colis-destinataire">
            Destinataire: {{ colis.nomDestinataire }} - {{ colis.adresse }} - {{ colis.telephone }}
          </div>
        </div>
        <div class="colis-edit" style="margin-right: 10px;">
          <label style="font-size:12px;color:#555;margin-right:6px;">Couleur:</label>
          <input type="color"
                 [value]="colis.couleur || '#999999'"
                 (input)="updateColisCouleur(i, $any($event.target).value)"
                 style="width:36px;height:28px;padding:0;border:none;background:transparent;cursor:pointer;" />
        </div>
        <button (click)="supprimerColis(i)" class="btn-delete">
          Supprimer
        </button>
      </div>
    </div>

    <button (click)="validerSimulation()" class="btn-validate full-width" [disabled]="!simulationForm.valid">
      Valider la simulation
    </button>
  </div>
</div>
